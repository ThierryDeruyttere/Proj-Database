{% extends "codegalaxy.html" %}

{% load staticfiles %}
{% load i18n %}

{% block base_body %}
<div class="row">
  <div class="large-12 columns">
    <h1>{% trans "Group overview" %}</h1>
  </div>
</div>

<div class="tabs-content">
  <div class="content active" id="all_groups">
    <div class="row">
      <div class="large-8 columns">
        <div id="search_groups" class="row collapse">
          <div class="row collapse postfix-radius">
            <div class="large-10 columns">
              <input type="text" placeholder="{% trans "Search groups..." %}">
            </div>
            <div class="large-2 columns">
              <button class="button postfix no-outline">{% trans "Search" %}</button>
            </div>
          </div>
          <div class="row collapse">
            <div class="switch small round right">
              <input id="my_groups" type="checkbox">
              <label for="my_groups"></label>
            </div>
            <div class="right">{% trans "Show my groups only" %}</div>
          </div>
        </div>
        <div id="search_result" class="row"></div>
      </div>
      <div class="large-4 columns text-center">
        <div class="panel">
          <legend>{% trans "Biggest Groups" %}</legend>
          {{ biggest_groups | safe }}
        </div class="panel">
        <a href="/g/create" class="round alert button">{% trans "Create new group" %}</a>
      </div>
    </div>
  </div>

  <div class="content" id="my_groups">
    <div class="row">
      <div class="large-12 columns">
        <div class="row collapse">
          <div class="large-6 columns">
            <input type="text" placeholder="Search groups...">
          </div>
          <a href="#" class="tiny button">Search</a>
        </div>
        <div class="row">
          {% for group in my_groups %}
          <div class="large-2 columns end">
            <div class="panel radius">
              <a href="../../g/{{ group.id }}">
                <img src="{% static group.getGroupPicture %}" />
                <div>
                  <h6 class="text-cut-off">{{ group.group_name }}</h6>
                </div>
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock base_body %}

{% block body_js %}
<script>
  function doSearch() {
    term_text = $("#search_groups input").val();

    var post_data = {term:term_text, my_groups:$('#my_groups').is(':checked')};

    $.ajax({
      type: "POST",
      url: "/s/groupOverview/",
      data: post_data,
      dataType: "text",

      success: function(response) {
        $("#search_result").html(response);
      },
      // error: function(jqXHR, textStatus, error) {
      //   setError(jqXHR.responseText);
      // }
    });
  }

  $("#search_groups button").click(function(e) {
    e.preventDefault();
    doSearch();
  });

  $("#search_groups input").on("input", function() {
    $("#search_groups button").click();
  });

  $("#my_groups").change(function(e) {
    doSearch();
  });

  $(document).ready(function() {
    $("#search_groups input[type=text]").trigger("input");
  });
</script>
{% endblock body_js %}
