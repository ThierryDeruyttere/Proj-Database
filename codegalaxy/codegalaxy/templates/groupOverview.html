{% extends "codegalaxy.html" %}

{% load staticfiles %}
{% load i18n %}

{% block base_body %}
<div class="row">
  <div class="large-9 columns">
    <h1>{% trans "Social" %}</h1>
  </div>
  <div class="large-3 columns end">
    <a href="/g/create" class="round alert button">{% trans "Create new group" %}</a>
  </div>
    <hr/>
</div>

<div class="row">
      <div class="large-8 columns">
        <div id="search_groups" class="row collapse">
          <div class="row collapse postfix-radius">
            <div class="large-10 columns">
              <input type="text" placeholder="{% trans "Search groups..." %}" value="{{ s_term }}">
            </div>
            <div class="large-2 columns">
              <button class="button postfix no-outline">{% trans "Search" %}</button>
            </div>
          </div>
          <div class="row collapse">
            <div class="switch small round left">
              {% if s_social %}
                <input id="my_groups" type="checkbox" checked>
              {% else %}
                <input id="my_groups" type="checkbox">
              {% endif %}
              <label for="my_groups"></label>
            </div>
            <div class="left">{% trans "Show my groups only" %}</div>
          </div>
        </div>
        <br>
        <div id="search_result" class="row"></div>
      </div>
      <div class="large-4 columns text-center">
        <div class="panel radius">
          <h5>Friend requests</h5>
          <hr>
          <h5>Group requests</h5>
          <hr>
        </div>
        <div class="panel radius">
          <p>{% trans "Biggest Groups" %}</p>
          {{ biggest_groups | safe }}
        </div class="panel">
      </div>
    </div>
</div>

{% endblock base_body %}

{% block body_js %}
<script>
  function doSearch() {
    term_text = $("#search_groups input[type=text]").val();


    var post_data = {term:term_text, my_groups:$('#my_groups').is(':checked')};

    $.ajax({
      type: "POST",
      url: "/s/social/",
      data: post_data,
      dataType: "text",

      success: function(response) {
        $("#search_result").html(response);
      }
      // error: function(jqXHR, textStatus, error) {
      //   setError(jqXHR.responseText);
      // }
    });
  }

  $("#search_groups button").click(function(e) {
    e.preventDefault();
    doSearch();
  });

  $("#search_groups input").on("input", function() {
    $("#search_groups button").click();
  });

  $("#my_groups").change(function(e) {
    doSearch();
  });

  $(document).ready(function() {
    $("#search_groups input[type=text]").trigger("input");
  });
</script>
{% endblock body_js %}
