{% extends "codegalaxy.html" %}

{%load staticfiles%}
{% load i18n %}

{% block base_body %}


<div class="row">
  <div class="large-3 columns text-center ">
    <div class="panel radius">
      <a href="#"><img src="{% static group.getPicture %}"></a>
      <br>
      <br>
      <h4><b>{{ group.group_name }}</b></h4>
      <br>
      <h6><b>Owner: </b> {{ group_owner }}</h6>
      <h6><b>Members: </b> {{ group_size }}</h6>
      {% if not is_member %}
      <form method="post" action="/g/{{group.id}}/">
        {% csrf_token %}
        <input type="submit" name="become_member" value="{% trans "Become member" %}" class="button success radius"/>
      </form>
      {% else %}
      <form method="post" action="/g/{{group.id}}/">
        {% csrf_token %}
        <input type="submit" name="leave_group" value="{% trans "Leave group" %}" class="button alert radius"/>
      </form>
      {% endif %}
    </div>
  </div>

  <div class="large-8 columns left">
    <ul class="tabs" data-tab>
      <li class="tab-title active"><a href="#feed">{% trans "Feed" %}</a></li>
      <li class="tab-title"><a href="#members">{% trans "Members" %}</a></li>
      {% if is_member %}
      {% if not group_permissions == 2 %}
      <li class="tab-title"><a href="#add_members">{% trans "Add New Members" %}</a></li>
      <li class="tab-title"><a href="#edit_group">{% trans "Edit" %}</a></li>
      {% endif %}
      {% endif %}
    </ul>

    <hr/>

    <div class="tabs-content">
      <div class="content active" id="feed">
        {% for item in data %}
          {% if item.type == 'FriendsWith' %}
          <div class="row">
            <div class="feed-item">
              <div class="large-2 columns"><img src="{% static "media/icons/rocket1.png" %}"/></div>
              <div class="large-10 columns end">
                <p>
                  <strong><a href="/u/{{ item.user.id }}">{{ item.user.name }} </a></strong>{% trans "became friends with" %} <a href="/u/{{ item.friend.id }}">{{ item.friend.first_name }} {{ item.friend.last_name }}</a>.
                </p>
                <p class="feed-timestamp">
                  <small><span class="octicon octicon-clock"></span>{{ item.befriended_on }}</small>
                </p>
              </div>
            </div>
          </div>
          {% endif %}
          {% if item.type == 'UserInGroup'%}
          <div class="row">
            <div class="feed-item">
              <div class="large-2 columns"><img src="{% static "media/icons/rocket1.png" %}"/></div>
              <div class="large-10 columns end">
                <p>
                  <strong><a href="/u/{{ item.user.id }}">{{ item.user.name }} </a></strong>{% trans "was added to group:" %} <a href="/g/{{ item.group.id }}">{{ item.group.group_name }}</a>.
                </p>
                <p class="feed-timestamp">
                  <small><span class="octicon octicon-clock"></span>{{ item.joined_on }}</small>
                </p>
              </div>
            </div>
          </div>
          {% endif %}
          {% if item.type == 'MadeExerciseList'%}
          <div class="row">
            <div class="feed-item">
              <div class="large-2 columns"><img src="{% static "media/icons/rocket1.png" %}"/></div>
              <div class="large-10 columns end">
                <p>
                  <strong><a href="/u/{{ item.user.id }}">{{ item.user.name }} </a></strong>{% trans "solved an exercise list:" %} <a href="/l/{{ item.exercise_list.id }}">{{ item.exercise_list.name }}</a> {% trans "and scored" %} {{ item.personal_list.score }}%.
                </p>
                <p class="feed-timestamp">
                  <small><span class="octicon octicon-clock"></span>{{ item.completed_on }}</small>
                </p>
              </div>
            </div>
          </div>
          {% endif %}
          {% if item.type == 'CreatedExerciseList'%}
          <div class="row">
            <div class="feed-item">
              <div class="large-2 columns"><img src="{% static "media/icons/rocket1.png" %}"/></div>
              <div class="large-10 columns end">
                <p>
                  <strong><a href="/u/{{ item.user.id }}">{{ item.user.name }} </a></strong>{% trans "created an exercise list:" %} <a href="/l/{{ item.exercise_list.id }}">{{ item.exercise_list.name }}</a>.
                </p>
                <p class="feed-timestamp">
                  <small><span class="octicon octicon-clock"></span>{{ item.created_on }}</small>
                </p>
              </div>
            </div>
          </div>
          {% endif %}
          <hr/>
          {% endfor %}
            <div class="pagination-centered">
              <ul class="pagination">
                {% if data.has_previous %}
                  {% if data.number = 2 %}
                    <li class="arrow"><a href="?page={{ data.previous_page_number }}">&laquo;</a></li>
                    <li><a href="?page=1">1</a></li>
                  {% elif data.number = 3 %}
                    <li class="arrow"><a href="?page={{ data.previous_page_number }}">&laquo;</a></li>
                    <li><a href="?page=1">1</a></li>
                    <li><a href="?page=2">2</a></li>
                  {% elif data.number > 3 %}
                    <li class="arrow"><a href="?page={{ data.previous_page_number }}">&laquo;</a></li>
                    <li><a href="?page=1">1</a></li>
                    <li class="unavailable"><a href="">&hellip;</a></li>
                    <li><a href="?page={{ data.previous_page_number }}">{{ data.previous_page_number }}</a></li>
                  {% endif %}
                {% endif %}
                <li class="current"><a href="">{{ data.number }}</a></li>
                {% if data.has_next %}
                  {% if data.paginator.num_pages|add:-2 > data.number %}
                    <li><a href="?page={{ data.next_page_number }}">{{ data.next_page_number }}</a></li>
                    <li class="unavailable"><a href="">&hellip;</a></li>
                    <li><a href="?page={{ data.paginator.num_pages }}">{{ data.paginator.num_pages }}</a></li>
                  {% elif data.paginator.num_pages|add:-1 > data.number %}
                    <li><a href="?page={{ data.next_page_number }}">{{ data.next_page_number }}</a></li>
                    <li><a href="?page={{ data.paginator.num_pages }}">{{ data.paginator.num_pages }}</a></li>
                  {% elif data.paginator.num_pages|add:-1 = data.number %}
                    <li><a href="?page={{ data.next_page_number }}">{{ data.next_page_number }}</a></li>
                  {% else %}
                    <li><a href="?page={{ data.paginator.num_pages }}">{{ data.paginator.num_pages }}</a></li>
                  {% endif %}
                  <li class="arrow"><a href="?page={{ data.next_page_number }}">&raquo;</a></li>
                {% endif %}
              </ul>
            </div>
          </div>
          <div class="content" id="edit_group">
            {% if group_permissions == 0 %}
              <form method="POST">
              {% csrf_token %}
              <input type="submit" value="{% trans "Delete Group" %}" name="delete_group" class="button radius alert">
            {% endif %}
            <form method="POST" action="/g/{{group.id}}/" enctype="multipart/form-data" data-abide>
              {% csrf_token %}
              <h5>{% trans "Upload group picture" %}</h5>
              <p>
                <input id="id_image" type="file" class="resizeme" name="image">
              </p>
              <input type="submit" value="{% trans "Edit Group Picture" %}" name="update_group_picture" class="small button round success">
            </form>
            <hr/>
          </div>
          <div class="content" id="add_members">
            {% for user in currentuser_friend_list %}
            <div class="small-12 columns">
              <div class="small-2 large-2 columns">
                <img src="{% static user.getPicture %}">
              </div>
              <div class="small-4 large-8 columns">{{user.first_name}} {{user.last_name}}</div>
              <form method="POST" action="/g/{{group.id}}/">
                {% csrf_token %}
                <div class="small-6 large-4 columns">
                  <input type="hidden" name="user_id_to_add" value="{{ user.id }}">
                  <input type="submit" name="add_friend" value="{% trans "Add User" %}" class="button round success">
                </div>
              </form>
              <hr/>
            </div>
            {% endfor %}
          </div>

          <div class="content" id="members">
            {% if is_member %}
            {% for member in user_list %}
            <div class="large-12 columns end">
              <a href="/u/{{ member.0.id }}">
                <div id="u_{{ member.0.id }}" class="panel radius">
                  <div class="row">
                    <div class="large-3 columns">
                      <img src="{% static member.0.getPicture %}"/>
                    </div>
                    <div class="large-6 columns">
                      <h5 class="text-cut-off"><b>{{ member.0.first_name }} {{ member.0.last_name }}</b></h5>
                      <h6><b>Status: </b>
                      {% if member.1 == 2 %}
                        {% trans "Member" %}</h6>
                      {% elif member.1 == 1 %}
                        {% trans "Admin" %}</h6>
                      {% elif member.1 == 0 %}
                        {% trans "Owner" %}</h6>
                      {% endif %}
                    </div>
                    {% if my_user_permissions == 1 %}
                    <div class="large-3 columns">
                      {% if not member.0.id == user.id %}
                        {% if member.1 == 2 %}
                        <form method="POST" action="/g/{{group.id}}/" enctype="multipart/form-data" data-abide>
                          {% csrf_token %}
                          <input type="hidden" name="user_id_to_delete" value="{{ member.0.id }}">
                          <input type="submit" value="{% trans "Delete" %}" name="remove_user" class="tiny button alert radius">
                        </form>
                        {% elif member.1 == 1 %}
                          {% if my_user_permissions == 0 %}
                            <form method="POST" action="/g/{{group.id}}/" enctype="multipart/form-data" data-abide>
                              {% csrf_token %}
                              <input type="hidden" name="user_id_to_delete" value="{{ member.0.id }}">
                              <input type="submit" value="{% trans "Delete" %}" name="remove_user" class="tiny button alert radius">
                            </form>
                          {% endif %}
                        {% endif %}
                      {% endif %}
                      {% if member.1 == 2 %}
                        <form method="POST" action="/g/{{group.id}}/" enctype="multipart/form-data" data-abide>
                          {% csrf_token %}
                          <input type="hidden" name="user_id_to_upgrade" value="{{ member.0.id }}">
                          <input type="submit" value="{% trans "Upgrade" %}" name="upgrade_user" class="tiny button success radius">
                        </form>
                      {% endif %}
                    </div>
                    {% elif my_user_permissions == 0 %}
                    <div class="large-3 columns">
                      {% if not member.0.id == user.id %}
                        {% if member.1 == 2 %}
                        <form method="POST" action="/g/{{group.id}}/" enctype="multipart/form-data" data-abide>
                          {% csrf_token %}
                          <input type="hidden" name="user_id_to_delete" value="{{ member.0.id }}">
                          <input type="submit" value="{% trans "Delete" %}" name="remove_user" class="tiny button alert radius">
                        </form>
                        {% elif member.1 == 1 %}
                          {% if my_user_permissions == 0 %}
                            <form method="POST" action="/g/{{group.id}}/" enctype="multipart/form-data" data-abide>
                              {% csrf_token %}
                              <input type="hidden" name="user_id_to_delete" value="{{ member.0.id }}">
                              <input type="submit" value="{% trans "Delete" %}" name="remove_user" class="tiny button alert radius">
                            </form>
                          {% endif %}
                        {% endif %}
                      {% endif %}
                      {% if member.1 == 2 %}
                        <form method="POST" action="/g/{{group.id}}/" enctype="multipart/form-data" data-abide>
                          {% csrf_token %}
                          <input type="hidden" name="user_id_to_upgrade" value="{{ member.0.id }}">
                          <input type="submit" value="{% trans "Upgrade" %}" name="upgrade_user" class="tiny button success radius">
                        </form>
                      {% endif %}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </a>
            </div>
            {% endfor %}
            {% else %}
            {% for member in user_list %}
            <div class="large-12 columns end">
              <a href="/u/{{ member.0.id }}">
                <div id="u_{{ member.0.id }}" class="panel radius">
                  <div class="row">
                    <div class="large-3 columns">
                      <img src="{% static member.0.getPicture %}"/>
                    </div>
                    <div class="large-6 columns">
                      <h5 class="text-cut-off"><b>{{ member.0.first_name }} {{ member.0.last_name }}</b></h5>
                      <h6><b>Status: </b>
                      {% if member.1 == 2 %}
                        {% trans "Member" %}</h6>
                      {% elif member.1 == 1 %}
                        {% trans "Admin" %}</h6>
                      {% elif member.1 == 0 %}
                        {% trans "Owner" %}</h6>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </a>
            </div>
            {% endfor %}
            {% endif %}
          </div>
        </div>
      </div>
    </div>

{% endblock base_body %}
