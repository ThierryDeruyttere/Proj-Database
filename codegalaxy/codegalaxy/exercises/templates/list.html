{% extends "codegalaxy.html" %}
{% load staticfiles %}

{% block head_js %}
  <script src="{% static "Chart.min.js" %}"></script>
{% endblock head_js %}

{% block base_body %}
  <head>
    <link rel="stylesheet" type="text/css" href="{% static "css/list.css" %}" />
  </head>

  <div class="row">
    <div class="large-12 columns">
      <div class="text-center">
        <div class="row">
          <h2>{{ list_name }}</h2>
        </div>
        <div class="row">
          <div class="large-6 large-centered text-center columns">
            <i>{{ list_description }}</i>
          </div>
        </div>

        <div class="row">
          <div class="large-6 large-centered text-center columns">
            <br/>
            {% if list_programming_lang == "Python" %}
              <img class="Icon" src="{% static "media/python.png" %}">
            {% elif list_programming_lang == "C++" %}
              <img class="Icon" src="{% static "media/C++.png" %}">
            {% elif list_programming_lang == "SQL" %}
              <img class="Icon" src="{% static "media/sql.png" %}">
            {% endif %}
          </div>
          <br/>
          {% if all_exercises|length > 0 %}
            <button class="small button Start" id="{{ cur_exercise }}">
              {% if found %}
                Continue
              {% else %}
                Start
              {% endif %}
            </button>
          {% endif %}
        </div>

        <div class ="row">
          <div class="large-4 large-centered columns">
            <div class="panel callout radius">
              <img id="subjects" src="{% static "media/subjects.png" %}">
              <div class="text-center">
                {% for subject in subjects %}
                  <span class="success label">{{ subject }}</span>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>

      {% if solved_all %}
        <div class="row">
          <div class="large-4 columns large-centered large-text-center">
            <div class="panel callout radius info">
              Rating:<br/>
              <form id="Rating" method="POST">
                <div class="rating">
                  <div id="raty"></div>
                </div>
              </form>
            </div>
          </div>
        </div>
      {% endif %}

      <div class ="row">
        <div class="large-7 large-centered text-center columns">
          <div class="panel callout radius info">
            <div class="progress small success round">
              <span class="meter" style="width: {{ percent }}%"></span>
              {{ percent }}% solved
            </div>
          </div>
        </div>
      </div>

      <div class ="row">
        <div class="large-7 large-centered text-center columns">
          <div class="panel callout radius info ">
            <ul class="large-block-grid-3">
              <li>
                <h4>{{ avg_score }}</h4>
                Average Score
              </li>
              <li>
                <h4>{{ avg_rating }}</h4>
                Average rating
              </li>
              <li>
                <h4>{{ number_of_users }}</h4>
                Users that finished list
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!--
      <div class ="row">
        <div class="large-7 large-centered text-center columns">
          <h2>Score Spread</h2>
          <br/>
          {{ score_spread |safe }}
        </div>
      </div>
      -->
    
      <div class ="row">
        <div class="large-7 large-centered text-center columns">
          <div class="panel callout radius info">
            <ul class="large-block-grid-2">
              <li>
                Made By
                <br/>
                <h4>{{ creator }}</h4>
              </li>
              <li>
                Made On
                <br/>
                <h4>{{ created_on }}</h4>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <hr>
      <div class="row">
        <div class="large-2 right columns">
          {% if correct_user %}
            <ul class="large-block-grid-3">
              <li><a href="/l/{{ id }}/importExercise" class="button tiny radius">Import exercise</a></li>
              <li></li>
              <li><a href="/l/{{ id }}/createExercise" class="button tiny radius">Create exercise</a></li>
            </ul>
          {% elif not correct_user %}
            <button class="tiny button radius" id="import">Add exercises to my list</button>
          {% endif %}
        </div>
        <div class="large-2 left columns">
          {% if correct_user %}
            <a type="button" class="button tiny radius" href="/l/{{ id }}/editList">Edit list</a>
          {% endif %}
        </div>
      </div>

      <div class ="row">
        <div class="large-3 large-centered large-text-center columns">
          Exercises
          <div class="row">
            {% for exercise in all_exercises %}
              <div class="panel radius callout exercise" id="Exercise{{ exercise.exercise_number }}">
                {{ exercise.title }}
                {% if exercise.solved %}
                  <div class="label success left"><i class="fi-checkbox"></i></div>
                {% endif %}
                <img class="Arrow" src="{% static "media/arrow.png" %}">
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      {% if similar_lists|length > 0 %}
        <div class ="row">
          <div class="large-7 large-centered text-center columns">
            <div class="panel callout radius info">
              <h3>ExerciseLists like this one:</h3>
              <ul class="large-block-grid-{{similar_lists|length}}">
                {% for similar_list in similar_lists %}
                  <li>
                    <a href="../{{ similar_list.id }}">{{similar_list.name}}</a><br/><br/>
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      {% endif %}

    </div>
  </div>
{% endblock base_body %}

{% block body_js %}
  <script src="{% static "raty/jquery.raty.js" %}"></script>
  <script>

    $('img').on('dragstart', function(event) { event.preventDefault(); });

    $(document).ready(function() {

      $(".Start").click(function(){
        var id = this.id;
        window.location += id;
      });


      $.fn.raty.defaults.path = "{{ STATIC_URL }}img";
      $('#raty').raty({
        score : {{ user_rating }},
        click: function(score){
          //AJAX -> post to server that the user rated

          $(function(){
            $.ajax({
              type: 'POST',
              url: "",
              data: {"rating" : score},

              success: function(response) {
              },

              error: function(xhr, textStatus, errorThrown){

              }

            });
          });

        }
      });
    });



  </script>
{% endblock %}
