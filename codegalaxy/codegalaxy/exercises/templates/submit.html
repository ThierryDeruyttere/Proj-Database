{% extends "codegalaxy.html" %}

{% block base_body %}
  {% load staticfiles %}
  {% load custom_filters %}

  <script src="{% static "codemirror/lib/codemirror.js" %}"></script>
  <link rel="stylesheet" href="{% static "codemirror/lib/codemirror.css" %}">
  <link rel="stylesheet" href="{% static "codemirror/theme/monokai.css" %}">
  <link rel="stylesheet" href="{% static "custom_css/exercise_style.css" %}">

  <div class="row">
    <div class="large-12 columns">
      <div class="panel">
        {% if solved %}
          <div class="row">
            <div class="large-text-center">
              <h1>Correct answer!</h1>
            </div>
          </div>

          <div class="row">
            <div class="large-7 columns large-centered">
              <div class="panel">
                <div class="large-text-center">
                  <h2>Your score:</h2>
                  <br/>
                  <br/>
                  <h1>{{ current_score }}/{{ max_score }}</h1>
                  <br/>
                  <br/>
                  <br/>
                  <br/>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="large-12 columns large-text-center">
              Rating:<br/>
              <div class="rating">
                {% for i in 5|get_range %}
                  <i class="fi-star" id="star{{ i }}" onclick="javascript:rate(this)"></i>
                {% endfor %}
                <form id="user_rating" method="POST">
                  {% csrf_token %}
                  <input id="current_rating" name="current_rating" value="1" type="hidden">
                </form>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="large-6 large-text-center columns">
              <a href="#" id="exercise_list" class="button small radius">Return to list</a>
            </div>
            <div class="large-6 large-text-center columns">
              <a id="next_exercise" href="#" class="button success small radius">Next exercise</a>
            </div>
          </div>

        {% else %}
          <div class="row">

          </div>
          <div class="row">
            <div class="large-text-center">
              <h2>Wrong answer</h2>
              <img src="{% static "media/Icons8-Ios7-Messaging-Sad.ico" %}" height="100px" width="100px">
            </div>
          </div>

          {% if question_type == "Code" %}
            <div class="row">
              <div class="large-3 columns">
                Your code outputted:
              </div>
            </div>

            <div class="row">
              <div class="large-5 columns">
                <textarea id="user_code" name="user_code">{{ user_output }}</textarea>

                <script>
                  var myCodeMirror = CodeMirror.fromTextArea(user_code,
                          {
                            lineNumbers: true,
                            mode: "python",
                            theme: "monokai"
                          });
                </script>
              </div>

              <div class="large-7 columns">
                <div class="panel">
                  <div class="large-text-center">
                    <h2>Your current score:</h2>
                    <br/>
                    <br/>
                    <h1>{{ current_score }}/{{ max_score }}</h1>
                    <br/>
                    <br/>
                    <br/>
                    <br/>
                  </div>

                </div>
              </div>
            </div>
          {% elif question_type == "Open Question" %}
            <br/>
            <div class="large-7 columns large-centered">
              <div class="panel">
                <div class="large-text-center">
                  <h2>Your current score:</h2>
                  <br/>
                  <br/>
                  <h1>{{ current_score }}/{{ max_score }}</h1>
                  <br/>
                  <br/>
                  <br/>
                  <br/>
                </div>

              </div>
            </div>
          {% endif %}

          <div class="large-text-center">
            <a href="../{{ question_id }}" class="button alert small radius">Try again</a>
          </div>

        {% endif %}
      </div>
    </div>
  </div>

{% endblock base_body %}
{% block body_js %}
  <script>
    function rate(obj){
      var id = obj.id;
      var value = id.replace("star","");
      var current_rating = 5 - value;
      document.getElementById("current_rating").value = current_rating.toString();
    }

    function sendForm(){
      var form =  document.getElementById("user_rating");
      form.submit();
      return true;
    }
    
    $("#exercise_list").on('click', function() {
      sendForm();
      window.location = "../{{ next_exercise }}";
    });

    $("#next_exercise").on('click', function() {
      sendForm();
      window.location = "..";
    });
  </script>
{% endblock body_js %}