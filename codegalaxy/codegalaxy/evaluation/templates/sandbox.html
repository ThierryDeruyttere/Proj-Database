{% extends "codegalaxy.html" %}
{% load staticfiles %}

{% block page_css %}
<link rel="stylesheet" href="{% static "css/sandbox.css" %}">
{% endblock page_css %}

{% block base_body %}
<div class="row text-center">
  <a href="#" id="text/x-python" class="lang_button"><img src="{% static "media/python.png"%}" class="prog-lang-icon active" alt="Python"></a>
  <a href="#" id="text/x-c++src" class="lang_button"><img src="{% static "media/C++.png"%}" class="prog-lang-icon" alt="C++"></a>
  <a href="#" id="text/x-sql" class="lang_button"><img src="{% static "media/sql.png"%}" class="prog-lang-icon" alt="SQL"></a>
</div>

<div class="row">
  <textarea id="user_code" name="user_code"></textarea>
</div>

<div class="row">
  <input type="button" name="test" class="button round success no-outline" id="evaluate" value="Evaluate"></input>
  <!-- <ul class="button-group">
    <li><a href="#" class="button">Button 1</a></li>
    <li><a href="#" class="button">Button 2</a></li>
    <li><a href="#" class="button">Button 3</a></li>
  </ul> -->
</div>


<div class="row">
  <div data-alert id="output" class="alert-box success radius">
    <div id="output_success" class="output-header">Success!</div>
    <div id="output_error" class="output-header" hidden>Oops, something went wrong...</div>
    <div id="output_text"></div>
  </div>
</div>
{% endblock base_body %}

{% block body_js %}
<script>
  var code_text = CodeMirror.fromTextArea(user_code,
    {
      lineNumbers: true,
      mode: "text/x-python",
      theme: "monokai",
      matchBrackets: true,
      autoCloseBrackets: true
    });

  function setError(text) {
    $("#output_text").html(text);

    $(".CodeMirror").addClass("error");
    $(".CodeMirror").switchClass("error", "", 2800, "easeInExpo");

    $("#output_success").hide();
    $("#output_error").show();

    $("#output").removeClass("success");
    $("#output").addClass("alert");
  }

  function setSuccess(text) {
    $("#output_text").html(text);

    $(".CodeMirror").addClass("success");
    $(".CodeMirror").switchClass("success", "", 2800, "easeInExpo");

    $("#output_error").hide();
    $("#output_success").show();

    $("#output").removeClass("alert");
    $("#output").addClass("success");
  }

  $("#evaluate").click(function()
  {
    var post_data = {code:code_text.getValue()};
    $.ajax({
      type: "POST",
      url: "/eval/" + code_text.getOption("mode").replace("text/x-", "").replace("src", "") + "/",
      data: post_data,
      dataType: "text",

      success: function(response) {
        setSuccess(response);
      },
      error: function(jqXHR, textStatus, error) {
        setError(jqXHR.responseText);
      }
    });
  });

  $(".lang_button").click(function() {
    code_text.setOption("mode", $(this).attr("id"));
    $(".lang_button>img").removeClass("active");
    $(this).find("img").addClass("active");
  });

</script>
{% endblock body_js %}
